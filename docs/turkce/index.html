<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="A future work" />
        <title>Türkçe / A Blog website</title>
        <link rel="stylesheet" href="/assets/default/style/style.css">
    </head>

    <body>

        <div class="container">
            <nav class="topbar">
                <h1 class="site-title" id="dark-toggle">A Blog website</h1>
                <details class="search">
                    <form class="search-form" id="search-form" action="">
                        <input aria-label="Search box" type="search" id="search" name="search" />
                        <button>Search</button>
                    </form>
                    <summary class="search-toggle">
                        <svg class="search-icon">
                            <use xlink:href="#search-icon"></use>
                        </svg>
                    </summary>
                </details>
                
                <svg class="icon-symbols">
                    <symbol id="search-icon" viewBox="0 0 512 512">
                        <path d="M344.5 298c15-23.6 23.8-51.6 23.8-81.7 0-84.1-68.1-152.3-152.1-152.3C132.1 64 64 132.2 64 216.3c0 84.1 68.1 152.3 152.1 152.3 30.5 0 58.9-9 82.7-24.4l6.9-4.8L414.3 448l33.7-34.3-108.5-108.6 5-7.1zm-43.1-166.8c22.7 22.7 35.2 52.9 35.2 85s-12.5 62.3-35.2 85c-22.7 22.7-52.9 35.2-85 35.2s-62.3-12.5-85-35.2c-22.7-22.7-35.2-52.9-35.2-85s12.5-62.3 35.2-85c22.7-22.7 52.9-35.2 85-35.2s62.3 12.5 85 35.2z"/>
                    </symbol>
                </svg>
                
                <script type="text/javascript" src="/assets/default/scripts/searchable.js"></script>
            </nav>

            <main class="content" id="posts-container">
                        <div class="post">
                            <h2><a href="/turkce/olay-ve-olasilik">
      <span
        data-editable="true"
        data-section="title"
        data-path="Türkçe/Olay ve Olasılık/post.md"
        data-foldered="true"
      >Olay ve Olasılık</span>
    </a></h2>
                            <p><img src="/turkce/olay-ve-olasilik/sorgular.jpg" alt="Ağaçlar olasılıklarını dallarıyla olaya döker"></p>
<h3>Ağaç sorguları</h3>
<p>Ağaçlarda kendimizi görebiliriz. Sınırsız şekillerde dallar her göz için farklı kesişir.
Akla basit gelen bir dizi genetik kuralın sonucu olarak bu ağaçlar bizi farklı düşlere koyar.

                            <p>deneme</p>
                            <p>Dec 31, 2022</p>
                        </div>
                        <div class="post">
                            <h2><a href="/turkce/herhangi-bir-text-post.html">
      <span
        data-editable="true"
        data-section="title"
        data-path="Türkçe/Herhangi bir text post.hbs"
        data-foldered="undefined"
      >Herhangi bir text post</span>
    </a></h2>
                            <p>Herhangi bir random post</p>

                            <p>random,bir,post,test</p>
                            <p>Oct 19, 2022</p>
                        </div>
                        <div class="post">
                            <h2><a href="/turkce/bu-andaydim.html">
      <span
        data-editable="true"
        data-section="title"
        data-path="Türkçe/Bu andaydım.markdown"
        data-foldered="undefined"
      >Bu andaydım</span>
    </a></h2>
                            <p>İşte tam bu andaydım. Düşündüm. Evimde kendime düşünmek için bir alan ayırmıştım ve orada uzanmış düşünüyordum.</p>
<p>Bazen Zindan Adası filmi aklıma geliyor.</p>
<p>Birliktelikten güçlük doğar.</p>
<p>Öykünmeler, öyle ya da böyle sanmalar ve sanılmalar. Bekleni.</p>
<p>Tembel bi adam olduğumu fırsat buldukça dile getirmek hoşuma gidiyor. Altı üstü bi doğrama tahtasını yağlamak, tahtaya masaj çekmek filan bana göre değil, ben tembel biriyim. Arada bi, kullandıktan sonra falan, yıkamaya okeyim yalnız.</p>
<p>Müzik zevkim gittikçe soyut olandan yana tavır alıyor. Beni karşısına almış. Müzik zevkimle yüzleşiyorum.</p>
<p>Birliktelik. Güçsüzlükten doğan ama güçlüklere evrilen. Sadece düşüncesi bile o kadar güçlü güçlükler tanıtıyor, tanımlıyor ve öyle güçsüzlük tanıları koyuyor ki. İradesiz, serbest, sarhoş gönüllülerin hayat bağını çözer.</p>
<p>Birlikteliksizlik güçten doğar.</p>
<p>Waiting for a cup of sexy hentai superstar.</p>

                            <p>kendim,düşünceler</p>
                            <p>May 18, 2021</p>
                        </div>
                        <div class="post">
                            <h2><a href="/turkce/kabanla-yurunen-deniz-kenarlari.html">
      <span
        data-editable="true"
        data-section="title"
        data-path="Türkçe/Kabanla Yürünen Deniz Kenarları.txt"
        data-foldered="undefined"
      >Kabanla Yürünen Deniz Kenarları</span>
    </a></h2>
                            <p>Aklımda tuttuğum onca yazı fikri hep bu anlarda yok oluyor.
Yeni eve taşınmama 12 gün kalmış.</p>
<p>Sevgi, öfke ve nefret arasında dalgalanıyorum. Sağlıklı kalabilmem için sevgim
yavaş yavaş ölmek zorunda, kanal tedavisi gibi. Yerini hissizlik ve yeni bir ölüm
almalı.  Önceki ölümler gibi; onun da yasını tutarım, bir süre özlem duyarım, bir
süre aklımda ölçer tartarım ve o da sonunda kabuğunu tutar.</p>
<p>Yazıldığı gibi kalan mesajlar vardır. Yazıldığı gibi -görülmeden– silinen
mesajlar da vardır. Öfke ve nefret de vardırlar. Gururdur ve saygısızlıktandır.
Sinire saplanan bir ve son iğnedir.</p>
<p>Aptal dalga sesleri ile mi hüzünlenmeye zorlamalı yoksa aptal Aphex Twin ile mi
uyuşmaya çalışmalı? Aptal Clubhouse. Bu yazıyı kabanımla yazıyorum. Askılıkta
asılı kendisi. Kabanımı seviyorum. O bir yaz kabanıdır. Deniz kenarında
yürürkendir tüm karmaşası ve hayat görüşü.</p>
<p>Bu kez pek bi&#39; zorunlu aptallık.</p>

                            <p>kendim,düşünceler,sarhoş</p>
                            <p>Apr 17, 2021</p>
                        </div>
                        <div class="post">
                            <h2><a href="/turkce/hepsi-buymus">
      <span
        data-editable="true"
        data-section="title"
        data-path="Türkçe/Hepsi Buymuş/post.hbs"
        data-foldered="true"
      >Hepsi Buymuş</span>
    </a></h2>
                            <p>Vim'de blog yazıyorum:</p>
<div><img src="/turkce/hepsi-buymus/vim.png" alt="Vim'de blog yazdığımın ekran görüntüsü."></div>
<p>Ne zamandır ikinci yazımı yazmak istiyordum. Şimdi ikna ettim kendimi ama aklıma bir şey gelmiyor.</p>
<p>Şunlardan bahsetmek istemiştim: Daft Punk'ın ayrılması, Teoman'ın yeni albüm çıkarması. Sanki hayatım müzik endeskliymiş gibi (değil (ama öyle gibi görünüyor (yine de değil))).</p>

                            <p>kendim,düşünceler,sarhoş</p>
                            <p>Apr 11, 2021</p>
                        </div>
                        <div class="post">
                            <h2><a href="/turkce/ilk-sey.html">
      <span
        data-editable="true"
        data-section="title"
        data-path="Türkçe/İlk Şey.hbs"
        data-foldered="undefined"
      >İlk Şey</span>
    </a></h2>
                            <p>İlk paragraf.</p>
<p>HTML yazmak neden istememeliyiz ki? Soyutlamamaya karar verirsem pekala HTML ile blog oluşturabilirim. Neyse artık.</p>
<p>16 yaşımdaydım galiba, buna benzer bir özel günlük yazmaya başlamıştım düz HTML ile.</p>
<p>Gafamın dönmeye başlamak üzere olduğunu hissediyorum. Dışarıda kar fırtınasına yakın bir şey var. Tek sorun: kar yağmıyor. Epey rüzgarlı sadece. Sigaradan sigaraya çıkıyorum dışarı.</p>

                            <p>kendim,düşünceler,ilk,sarhoş</p>
                            <p>Mar 7, 2021</p>
                        </div>
            </main>
        </div>

        <svg class="icon-symbols">
            <symbol id="search-icon" viewBox="0 0 512 512">
                <path d="M344.5 298c15-23.6 23.8-51.6 23.8-81.7 0-84.1-68.1-152.3-152.1-152.3C132.1 64 64 132.2 64 216.3c0 84.1 68.1 152.3 152.1 152.3 30.5 0 58.9-9 82.7-24.4l6.9-4.8L414.3 448l33.7-34.3-108.5-108.6 5-7.1zm-43.1-166.8c22.7 22.7 35.2 52.9 35.2 85s-12.5 62.3-35.2 85c-22.7 22.7-52.9 35.2-85 35.2s-62.3-12.5-85-35.2c-22.7-22.7-35.2-52.9-35.2-85s12.5-62.3 35.2-85c22.7-22.7 52.9-35.2 85-35.2s62.3 12.5 85 35.2z"/>
            </symbol>
            </symbol>
        </svg>

        <script type="text/javascript" src="/assets/default/scripts/base.js"></script>
    </body>

</html>
<template id="editor-tmpl">
  <div class="writ-editor">
    <div class="checkbox-control">
      <input type="checkbox" class="checkbox-input" id="edit-mode" />
      <label for="edit-mode" class="checkbox-label">
        Edit mode
      </label>
    </div>
    <button type="button" id="rebuild-btn">Rebuild</button>
    <button type="button" id="save-btn">Save</button>
    <div class="unsaved-changes">
      <h3>Unsaved changes:</h3>
      <ul id="unsaved-changes-list" class="unsaved-changes-list"></ul>
    </div>
  </div>
</template>

<style type="text/css">
:root {
  --editor-height: 36px;
}

body {
  margin-top: var(--editor-height);
}

.writ-editor {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: var(--editor-height);
  background: #fffa;
  backdrop-filter: blur(5px);
  transition: all .5s;
}

.writ-editor .checkbox-control {
  --padding: 0.25rem;
  padding: var(--padding);
  position: relative;
  display: inline-flex;
}

.writ-editor .checkbox-control .checkbox-input {
  margin: 0;
  position: absolute;
  top: 50%;
  left: calc(var(--padding) + 0.5rem);
  z-index: 1;
  transform: translateY(-55%);
}

.writ-editor .checkbox-control .checkbox-label {
  padding: 0.5em 0.5em 0.4em 1.75em;
  font: normal 14px/1 helvetica, arial, sans-serif;
  background: hotpink;
  border-radius: 5px;
}

.writ-editor .checkbox-control :checked + .checkbox-label {
  background: yellow;
}

.writ-editor .checkbox-control .checkbox-input {
  margin: 0;
  align-self: flex-start;
}

.writ-editor .unsaved-changes {
  max-height: initial;
  overflow: visible;
  opacity: 1;
  transform: scale(1, 1);
}

.writ-editor .unsaved-changes {
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  transform: scale(1, 0);
  transition: all .5s;
}

body.edit-mode [data-editable="true"] {
  --outline-offset: 7px;
  --outline-width: 3px;
  --outline-color: gainsboro;
  box-shadow:
    0 0 0 var(--outline-offset) white,
    0 0 0 calc( var(--outline-offset) + var(--outline-width) ) var(--outline-color);
  outline-offset: var(--outline-offset);
  border-radius: 1px;
  transition: all .3s;
}

body:not(.edit-mode) [data-editable="true"][data-section="summary"] {
  opacity: 0;
  position: absolute;
}

body.edit-mode [data-editable="true"][data-section="summary"] {
  --summary-color: gainsboro;
  position: relative;
  display: inline-block;
  width: 100%;
  height: 1px;
  margin: 0.5rem 0;
  padding: 1rem 0;
  cursor: ns-resize;
  background: var(--summary-color);
  transform: scaleX(0.3);
  opacity: 1;
  box-shadow:
    inset 0 calc(1rem - 1px) 0 white,
    inset 0 -1rem 0 white;
}

body.edit-mode [data-editable="true"][data-section="summary"]:hover {
  box-shadow:
    inset 0 0.8rem 0 white,
    inset 0 -0.8rem 0 white;
}

body.edit-mode [data-editable="true"]:hover {
  --outline-color: deepskyblue;
}

body.edit-mode [data-editable="true"]:hover [data-section="summary"]{
  --summary-color: deepskyblue;
}

body.edit-mode [data-editable="true"]:focus-within {
  --outline-color: transparent;
  --outline-offset: 1px;
}

body.edit-mode [data-editable="true"]:focus-within [data-section="summary"] {}
</style>

<script type="text/javascript">
  const query = document.querySelector.bind(document)
  const queryAll = document.querySelectorAll.bind(document)

  const editorTemplate = query('#editor-tmpl')
  const editorElement = editorTemplate.content.firstElementChild
  const unsavedChangesList = editorElement.querySelector('#unsaved-changes-list')

  const rebuild = () => {
    return fetch('/cms/refresh')
  }

  const Post = {
    updateContent(path, content) {
      return fetch(`/cms/post`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          content,
          path
        })
      })
    },

    updateTitle(path, title, foldered) {
      return fetch(`/cms/post`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          title,
          updateUrl: true,
          path,
          foldered
        })
      })
    }
  }

  const findParent = (element, selector) => {
    if (element === document.body) {
      return null
    }
    const el = document.createElement('div')
    el.innerHTML = element.parentElement.outerHTML
    if (el.querySelector(selector)) {
      return element.parentElement
    }
    return findParent(element.parentElement, selector)
  }

  const omit = (object, keyToOmit) => {
    const keys = Object.keys(object)
    const restKeys = keys.filter(k => k !== keyToOmit)
    const restObject = restKeys.reduce((obj, key) => {
      return {
        ...obj,
        [key]: object[key]
      }
    }, {})
    return restObject
  }

  const restoreSeeMore = (content) => {
    const el = document.createElement('div')
    el.innerHTML = content
    const seeMore = el.querySelector('[data-section="summary"]')
    const parentNode = seeMore.parentNode
    const grandParentNode = parentNode.parentNode
    if (grandParentNode && !grandParentNode.querySelector('[data-section="content"]')) {
      const isFirst = !seeMore.previousSibling
      const isOnly = isFirst && !seeMore.nextSibling
      const insertPosition = isFirst ? 'beforeBegin' : 'afterEnd'
      parentNode.insertAdjacentElement(insertPosition, seeMore)
      if (isOnly) {
        parentNode.remove()
      }
      return restoreSeeMore(el.innerHTML)
    }
    seeMore.replaceWith('\{\{seeMore}}')
    return el.innerHTML
  }

  let editMode = false
  let unsavedChanges = {}

  document.body.appendChild(editorElement)
  document.title = (() => {
    var el = document.createElement('div')
    el.innerHTML = document.title
    return el.innerText
  })()

  query('#rebuild-btn').addEventListener('click', () => {
    rebuild()
  })

  query('#save-btn').addEventListener('click', async () => {
    console.log('changes', unsavedChanges)
    Object.keys(unsavedChanges).forEach(async (filePath) => {
        const change = unsavedChanges[filePath]
        if (!change) {
          return
        }
        if (change.content) {
          await Post.updateContent(filePath, restoreSeeMore(change.content))
        }
        if (change.title) {
          await Post.updateTitle(filePath, change.title, change.foldered)
        }
    })
  })

  query('#edit-mode').addEventListener('change', (e) => {
    document.body.classList.toggle('edit-mode')
    editMode = !editMode
    editables.forEach(editable => {
      editable.contentEditable = e.target.checked
    })
  })

  const editables = Array.from(queryAll('[data-editable="true"]'))
  const originals = editables.map(e => ({
    path:
      e.dataset.section === 'summary' ?
      findParent(e, '[data-section="content"]').dataset.path :
      e.dataset.path,
    content: e.innerHTML
  }))

  editables.forEach(editable => {
    let { section, path, foldered } = editable.dataset
    if (section === 'summary') {
      path = findParent(editable, '[data-section="content"]').dataset.path
    }
    const originalContent = originals.find(c => c.path === path).content

    editable.addEventListener('input', (e) => {
      const isSameContent = originalContent === editable.innerHTML
      if (isSameContent) {
        const otherChanges = omit(omit(unsavedChanges[path], section), 'foldered')
        if (Object.keys(otherChanges).length) {
          unsavedChanges[path] = otherChanges
        } else {
          unsavedChanges = omit(unsavedChanges, path)
        }
      } else {
        unsavedChanges[path] = {
          ...unsavedChanges[path],
          [section]: editable.innerHTML.trim(),
          foldered: foldered === 'true' || foldered === true
        }
      }
      unsavedChangesList.innerHTML = Object.keys(unsavedChanges).map(path => `
        ${Object.keys(unsavedChanges[path]).map(key => `
          <li>${path} (${unsavedChanges[path][key]})</li>
        `)}
      `).join('')
      editorElement.classList.toggle('unsaved', Object.keys(unsavedChanges).length)
    })

    editable.addEventListener('click', e => {
      if (editMode && findParent(editable, 'a')) {
        e.preventDefault()
      }
    })
  })
</script>
